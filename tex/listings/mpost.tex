%% Define {listings:Language:MYMP} and environment mpostcode[label]

\ifdefined\texrc@package@config@listings@tex\else
\def\texrc@package@config@listings@tex{LOADED}

%{{{ New listings language: MYMP => for metapost and metafont

\definecolor{mpkeyword}{rgb}{0.1, 0.3, 0.8}
\definecolor{mpinternalconstants}{rgb}{0.8, 0.6, 0.1}
\definecolor{mptype}{rgb}{0.5, 0.4, 0.9}
\definecolor{mpdef}{rgb}{0.9, 0.2, 0.2}
\definecolor{mfcmd}{rgb}{0.9, 0.8, 0.2}
\definecolor{mpstring}{rgb}{0.2, 0.8, 0.8}
\definecolor{mpexp}{rgb}{0.9, 0.3, 0.8}

\lstdefinelanguage{MYMP}{%
    sensitive=true,% case sensitive
    basicstyle=\ttfamily,
    %{{{ metapost keyword
    keywords={else, elseif, endfor, exitif, fi, for, forever, forsuffixes, if, step, until, beigngroup, endgroup},%
    keywords=[2]{defaultcolormodel, hour, minute, linecap, linejoin,%{{{ internal var
        miterlimit, mpprocset, mpversion, numberprecision,%
        numbersystem, outputfilename, outputformat,%
        outputformatoptions, outputtemplate, prologues,%
        restoreclipcolor, tracinglostchars, troffmode, truecorners,%
        autorounding, boundarychar, charcode, chardp, chardx,%
        chardy, charext, charht, charic, charwd, day, designsize,%
        fillin, fontmaking, granularity, hppp, jobname, month,%
        pausing, proofing, showstopping, smoothing, time,%
        tracingcapsules, tracingchoices, tracingcommands,%
        tracingedges, tracingequations, tracingmacros,%
        tracingonline, tracingoutput, tracingpens,%
        tracingrestores, tracingspecs, tracingstats,%
        tracingtitles, turningcheck, vppp, warningcheck,%
        tracingtitles, turningcheck, vppp, warningcheck,%
        xoffset, year, yoffset%
    } %}}} end internal variable
    keywords=[3]{ none%{{{ mpdef
    },%}}} end mpdef1
    keywords=[7]{withshade,luacall, message,%{{{ mpdef2
        def, enddef, beginfig, clear_pen_memory, clearit, clearpen, clearpen,%
        clearxy, colorpart, cutdraw, downto, draw, drawarrow,%
        drawdblarrow, drawdot, drawoptions, erase,%
        exitunless, fill, filldraw, flex, gobble, hide, interact,%
        label, loggingall, makelabel, numtok, penstroke, pickup,%
        range, reflectedabout, rotatedaround, shipit,%
        stop, superellipse, takepower, tracingall, tracingnone,%
        undraw, undrawdot, unfill, unfilldraw, upto, rotatedabout,%
        beginchar, capsule_def, change_width,%
        italcorr, labelfont, lowres_fix, makebox,%
        makegrid, maketicks, mode_def, mode_setup, proofrule, smode,%
        cull, cullit, gfcorners, imagerules, nodisplays,%
        notransforms, openit, proofoffset, screenchars,%
        screenrule, screenstrokes, showit, killtext,%
        boxjoin, drawboxed, drawboxes, drawunboxed,%
        Gfor, Gxyscale, OUT, auto, begingraph, endgraph, gdata,%
        gdraw, gdrawarrow, gdrawdblarrow, gfill, plot,%
        anch_sidebars_draw, boxfilloptions, boxlineoptions,%
        FlushSyncTasks, ProcessSyncTask, ResetSyncTasks,%
        SetSyncColor, SetSyncThreshold, SyncTask,%
        FlushSyncTasks, ProcessSyncTask,%
        RegisterLocalTextArea, RegisterPlainTextArea,%
        RegisterRegionTextArea, RegisterTextArea,%
        ResetLocalTextArea, ResetSyncTasks, ResetTextAreas,%
        SaveTextAreas, SetSyncColor, SetSyncThreshold,%
        SyncTask, anchor_box, box_found, boxfilloptions,%
        boxgridoptions, boxlineoptions, collapse_multi_pars,%
        naturalfigure, registerfigure, DrawFoFrame,%
        constructedfunction, constructedpairs,%
        constructedpath, curvedfunction, curvedpairs,%
        curvedpath, function, pathconnectors, straightfunction,%
        straightpairs, straightpath,%
        Gfor, OUT, auto, begingraph, circles, crosses, diamonds,%
        downtriangles, endgraph, gdata, gdraw, gdrawarrow,%
        gdrawdblarrow, gfill, graph_addto,%
        graph_xyscale, lefttriangles, makefunctionpath, plot,%
        plotsymbol, points, rainbow, righttriangles, smoothpath,%
        squares, stars, uptriangles, witherrorbars,%
        hlingrid, hloggrid, vlingrid, vloggrid,%
        begingraphictextfig, data_mpo_file,%
        data_mpy_file, doloadfigure, endfig,%
        endgraphictextfig, fill, fixedplace, graphictext,%
        loadfigure, new_graphictext, normalwithshade, number,%
        old_graphictext, outlinefill, protectgraphicmacros,%
        resetfig, reversefill, withdrawcolor, withfillcolor,%
        autoalign, bitmapimage, circular_shade, cmyk, comment,%
        defineshade, eofill, eofillup, externalfigure, figure,%
        fillup, label, linear_shade, multitonecolor, namedcolor,%
        nofill, onlayer, passarrayvariable, passvariable,%
        plain_label, register, resolvedcolor, scantokens,%
        set_circular_vector, set_linear_vector, shaded,%
        spotcolor, startpassingvariable, stoppassingvariable,%
        thelabel, transparent, usemetafunlabels,%
        useplainlabels, withcircularshade, withlinearshade,%
        withmask, withproperties, withshadecenter,%
        withshadecolors, withshadedirection, withshadedomain,%
        withshadefactor, withshadefraction, withshadeorigin,%
        withshaderadius, withshadestep, withshadetransform,%
        withshadevector, withtransparency,%
        BoundCoverAreas, BoundPageAreas, Enlarged, FakeRule,%
        FakeWord, LoadPageState, OverlayBox, RuleColor,%
        SetAreaVariables, SetPageArea, SetPageBackPage,%
        SetPageCoverPage, SetPageField, SetPageFrontPage,%
        SetPageHsize, SetPageHstep, SetPageLocation,%
        SetPagePage, SetPageSpine, SetPageVariables,%
        SetPageVsize, SetPageVstep, StartCover, StartPage,%
        StopCover, StopPage, SwapPageState, innerenlarged,%
        llEnlarged, lrEnlarged, outerenlarged, ulEnlarged, urEnlarged,%
        drawline, drawshape, some_shape,%
        finishglyph, prepareglyph,%
        addbackground, b_color, beginglyph, break, centerarrow,%
        clearxy, condition, data_mpd_file, detaileddraw,%
        detailpaths, dowithpath, draw, drawboundary,%
        drawboundingbox, drawcontrollines, drawcontrolpoints,%
        drawfill, draworigin, drawpath, drawpathonly,%
        drawpathwithpoints, drawpoint, drawpointlabels,%
        drawpoints, drawticks, drawwholepath, drawxticks,%
        drawyticks, endglyph, fill, finishsavingdata, g_color,%
        inner_boundingbox, job_name, leftarrow, loadmodule,%
        midarrowhead, naturalizepaths, newboolean, newcolor,%
        newnumeric, newpair, newpath, newpicture, newstring,%
        newtransform, normalcolors, normaldraw, normalfill,%
        normalwithcolor, outer_boundingbox, pop_boundingbox,%
        popboundingbox, popcurrentpicture, push_boundingbox,%
        pushboundingbox, pushcurrentpicture, r_color, readfile,%
        recolor, redraw, refill, register_dirty_chars,%
        remapcolor, remapcolors, remappedcolor, reprocess,%
        resetarrows, resetcolormap, resetdrawoptions,%
        resolvedcolor, restroke, retext, rightarrow, savedata,%
        saveoptions, scale_currentpicture, set_ahlength,%
        set_grid, showgrid, startplaincompatibility,%
        startsavingdata, stopplaincompatibility,%
        stopsavingdata, stripe_path_a, stripe_path_n, undashed,%
        undrawfill, untext, visualizeddraw, visualizedfill,%
        visualizepaths, withcolor, withgray,%
        xscale_currentpicture, xshifted,%
        xyscale_currentpicture, yscale_currentpicture,yshifted%
    },%}}} end mpdef
    keywords=[4]{boolean, numeric, pair, path, pen, picture, string, transform},% type
    keywords=[5]{addto, also, at, batchmode, contour, cull, delimiters,%{{{ mfcommand
        display, doublepath, dropping, dump, end, errhelp,%
        errmessage, errorstopmode, everyjob, from, interim,%
        inwindow, keeping, let, message, newinternal,%
        nonstopmode, numspecial, openwindow, outer, randomseed,%
        save, scrollmode, shipout, show, showdependencies,%
        showstats, showtoken, showvariable, special, to, withpen,%
        withweight
    }, %}}} end mfcommand
    keywords=[6]{and, charexists, false, known, not, odd, or, true, unknown,%{{{ mpexp
        ASCII, angle, cosd, directiontime, floor, hex, length,%
        mexp, mlog, normaldeviate, oct, sind, sqrt, totalweight,%
        turningnumber, uniformdeviate, xpart, xxpart, xypart, ypart, yxpart, yypart,%
        of, penoffset, point, postcontrol, precontrol, rotated,%
        scaled, shifted, slanted, transformed, xscaled, yscaled, zscaled,%
        atleast, controls, c, cycle, makepath, reverse, subpath, tension,%
        makepen, nullpen, pencircle, nullpicture,%
    char, decimal, readstring, str, substring, abs, rotatedabout},%}}} mpexp
    keywordstyle=\color{mpkeyword}\tt, keywordstyle=[2]\tt\color{mpinternalconstants},%
    keywordstyle=[3]\tt\color{mpdef}, keywordstyle=[4]\tt\color{mptype},keywordstyle=[7]\tt\color{mpdef},%
    keywordstyle=[5]\tt\color{mfcmd},keywordstyle=[6]\tt\color{mpexp},%
    %}}} end mp keyword
    comment=[l]{\%},% line comments
    commentstyle=\it\small\color{texcomment},
    %{{{ String
    morestring=[b]",
    morestring=[b]',
    stringstyle=\color{mpstring}%
    %}}} End String
}
%}}} end MYMP

\fi
